{% extends "base.html" %}

{% block title %}Intake Form - {{ intake.full_name }}{% endblock %}

{% block content %}
    <p><a href="/admin/intake-forms">&larr; Back to Intake Forms</a></p>

    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
        <h1 style="margin: 0;">{{ intake.full_name }}</h1>
        <div>
            {% if intake.reviewed_by_admin %}
                <span class="badge badge-success" style="font-size: 14px; padding: 8px 12px;">Reviewed</span>
            {% else %}
                <span class="badge badge-warning" style="font-size: 14px; padding: 8px 12px;">Pending Review</span>
            {% endif %}
        </div>
    </div>

    <p style="color: #666;">Submitted: {{ intake.created_at.strftime('%Y-%m-%d at %H:%M') }}</p>

    <!-- Associated Booking -->
    {% if intake.booking %}
    <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <strong>Associated Booking:</strong>
        {{ intake.booking[0].service.name if intake.booking else 'N/A' }} on
        {{ intake.booking[0].booking_date if intake.booking else 'N/A' }} at
        {{ intake.booking[0].booking_time if intake.booking else 'N/A' }}
    </div>
    {% endif %}

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">

        <!-- Personal Information -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
            <h3 style="margin-top: 0;">Personal Information</h3>
            <table style="margin: 0;">
                <tr><td style="border: none; padding: 5px 15px 5px 0;"><strong>Full Name:</strong></td><td style="border: none; padding: 5px 0;">{{ intake.full_name }}</td></tr>
                <tr><td style="border: none; padding: 5px 15px 5px 0;"><strong>Date of Birth:</strong></td><td style="border: none; padding: 5px 0;">{{ intake.date_of_birth }} {% if intake.is_minor %}<span class="badge badge-warning">Minor</span>{% endif %}</td></tr>
                <tr><td style="border: none; padding: 5px 15px 5px 0;"><strong>Email:</strong></td><td style="border: none; padding: 5px 0;"><a href="mailto:{{ intake.email }}">{{ intake.email }}</a></td></tr>
                <tr><td style="border: none; padding: 5px 15px 5px 0;"><strong>Phone:</strong></td><td style="border: none; padding: 5px 0;">{{ intake.phone }}</td></tr>
                <tr><td style="border: none; padding: 5px 15px 5px 0;"><strong>Address:</strong></td><td style="border: none; padding: 5px 0;">{{ intake.address or '-' }}</td></tr>
                <tr><td style="border: none; padding: 5px 15px 5px 0;"><strong>ID Type:</strong></td><td style="border: none; padding: 5px 0;">{{ intake.id_type or '-' }}</td></tr>
            </table>

            {% if intake.is_minor %}
            <div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin-top: 15px;">
                <strong>Parent/Guardian:</strong><br>
                {{ intake.parent_guardian_name or 'Not provided' }}<br>
                {{ intake.parent_guardian_phone or '' }}<br>
                Parental Consent: {% if intake.parental_consent %}Yes{% else %}No{% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Declaration -->
        <div style="background: #e8f8f0; padding: 20px; border-radius: 8px;">
            <h3 style="margin-top: 0;">Declaration</h3>
            <p>
                <strong>Confirmed accurate information:</strong>
                {% if intake.declaration_confirmed %}
                    <span class="badge badge-success">Yes</span>
                {% else %}
                    <span class="badge badge-danger">No</span>
                {% endif %}
            </p>
        </div>
    </div>

    <!-- Admin Review Section -->
    <div style="background: #2c3e50; color: white; padding: 20px; border-radius: 8px; margin-top: 30px;">
        <h3 style="margin-top: 0; color: white;">Admin Review</h3>

        {% if intake.reviewed_by_admin %}
            <p><span class="badge badge-success">Reviewed</span></p>
            {% if intake.admin_notes %}
                <p><strong>Notes:</strong> {{ intake.admin_notes }}</p>
            {% endif %}
        {% else %}
            <form method="POST" action="/admin/intake-forms/{{ intake.id }}/review">
                <label style="color: white;">Admin Notes (optional):</label>
                <textarea name="admin_notes" rows="3" placeholder="Add any notes about this client..."></textarea>
                <button type="submit" class="btn-success">Mark as Reviewed</button>
            </form>
        {% endif %}
    </div>
{% endblock %}
