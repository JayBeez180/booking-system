{% extends "base.html" %}

{% block title %}Clients{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1>Clients</h1>
        <p style="color: #666; margin: 5px 0 0 0;">
            {{ total_clients }} total clients ¬∑ {{ opted_in_count }} opted in for emails
        </p>
    </div>
    <div style="display: flex; gap: 10px;">
        <a href="{{ url_for('admin_client_tags_list') }}" class="btn">Manage Tags</a>
        <a href="{{ url_for('admin_clients_import') }}" class="btn btn-success">Import CSV</a>
    </div>
</div>

<!-- Filters -->
<div class="card" style="margin-bottom: 20px; padding: 15px;">
    <form method="GET" style="display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end;">
        <div style="flex: 1; min-width: 200px;">
            <label style="font-size: 12px; color: #666;">Search</label>
            <input type="text" name="search" value="{{ search }}" placeholder="Name, email, or phone..." style="margin: 0;">
        </div>
        <div style="min-width: 150px;">
            <label style="font-size: 12px; color: #666;">Tag</label>
            <select name="tag" style="margin: 0;">
                <option value="">All Tags</option>
                {% for tag in tags %}
                <option value="{{ tag.id }}" {% if selected_tag == tag.id %}selected{% endif %}>{{ tag.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div style="min-width: 150px;">
            <label style="font-size: 12px; color: #666;">Email Opt-in</label>
            <select name="opt_in" style="margin: 0;">
                <option value="">All</option>
                <option value="yes" {% if opt_in == 'yes' %}selected{% endif %}>Opted In</option>
                <option value="no" {% if opt_in == 'no' %}selected{% endif %}>Opted Out</option>
            </select>
        </div>
        <button type="submit" class="btn">Filter</button>
        {% if search or selected_tag or opt_in %}
        <a href="{{ url_for('admin_clients') }}" class="btn" style="background: #6c757d;">Clear</a>
        {% endif %}
    </form>
</div>

<!-- Client List -->
{% if clients %}
<div class="table-responsive">
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Tags</th>
                <th>Bookings</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for client in clients %}
            <tr>
                <td>
                    <a href="{{ url_for('admin_client_detail', client_id=client.id) }}" style="font-weight: 500;">
                        {{ client.name or '(No name)' }}
                    </a>
                </td>
                <td>{{ client.email or '-' }}</td>
                <td>{{ client.phone or '-' }}</td>
                <td>
                    {% for tag in client.tags %}
                    <span style="display: inline-block; background: {{ tag.color }}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; margin: 2px;">
                        {{ tag.name }}
                    </span>
                    {% endfor %}
                </td>
                <td>{{ client.total_bookings or 0 }}</td>
                <td>
                    {% if client.unsubscribed_at %}
                    <span style="color: #dc3545;">Unsubscribed</span>
                    {% elif client.email_opt_in %}
                    <span style="color: #28a745;">Opted In</span>
                    {% else %}
                    <span style="color: #6c757d;">Not opted in</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('admin_client_detail', client_id=client.id) }}" class="btn btn-sm">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if pagination.pages > 1 %}
<div style="display: flex; justify-content: center; gap: 5px; margin-top: 20px;">
    {% if pagination.has_prev %}
    <a href="{{ url_for('admin_clients', page=pagination.prev_num, search=search, tag=selected_tag, opt_in=opt_in) }}" class="btn btn-sm">‚Üê Prev</a>
    {% endif %}

    <span style="padding: 8px 15px; color: #666;">
        Page {{ pagination.page }} of {{ pagination.pages }}
    </span>

    {% if pagination.has_next %}
    <a href="{{ url_for('admin_clients', page=pagination.next_num, search=search, tag=selected_tag, opt_in=opt_in) }}" class="btn btn-sm">Next ‚Üí</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="card" style="text-align: center; padding: 40px;">
    <div style="font-size: 48px; color: #ccc; margin-bottom: 15px;">üë•</div>
    <h3 style="margin: 0 0 10px 0;">No clients found</h3>
    <p style="color: #666; margin: 0 0 20px 0;">
        {% if search or selected_tag or opt_in %}
        Try adjusting your filters
        {% else %}
        Import your client list to get started
        {% endif %}
    </p>
    <a href="{{ url_for('admin_clients_import') }}" class="btn btn-success">Import Clients</a>
</div>
{% endif %}

<style>
.btn-sm {
    padding: 5px 12px;
    font-size: 13px;
}
.table-responsive {
    overflow-x: auto;
}
@media (max-width: 768px) {
    table {
        font-size: 14px;
    }
    table td, table th {
        padding: 10px 8px;
    }
}
</style>
{% endblock %}
